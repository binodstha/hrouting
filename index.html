<!DOCTYPE html>
<html>

<head>

  <title>Quick Start - Leaflet</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>



</head>

<body style="margin: 0;">



  <div id="mapid" style="width: 100%; height: 80%; position: absolute; overflow: hidden; "></div>
  <button onclick="buttonClick();" style="position: absolute; bottom: 20px;">Find Path</button>
  <script>

    var mymap = L.map('mapid').setView([27.705965188185843, 85.31947687268259], 13);

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1
    }).addTo(mymap);

    // L.marker([51.5, -0.09]).addTo(mymap)
    // 	.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

    // L.circle([51.508, -0.11], 500, {
    // 	color: 'red',
    // 	fillColor: '#f03',
    // 	fillOpacity: 0.5
    // }).addTo(mymap).bindPopup("I am a circle.");

    // L.polygon([
    // 	[51.509, -0.08],
    // 	[51.503, -0.06],
    // 	[51.51, -0.047]
    // ]).addTo(mymap).bindPopup("I am a polygon.");


    var popup = L.popup();


    var point1 = "";
    var point2 = "";
    var pt1, pt2, path;

    function onMapClick(e) {
      console.log(e.latlng);
      if (point1 === "") {
        point1 = e.latlng.lng + "," + e.latlng.lat
        pt1 = L.marker([e.latlng.lat, e.latlng.lng]);
        pt1.addTo(mymap);
      } else if (point2 === "") {
        point2 = e.latlng.lng + "," + e.latlng.lat
        pt2 = L.marker([e.latlng.lat, e.latlng.lng]);
        pt2.addTo(mymap);
      }
    }


    mymap.on('click', onMapClick);


    function buttonClick() {
      console.log(point1);
      console.log(point2);
      console.log("button click")

      var request = new XMLHttpRequest();
      var url = 'https://api.openrouteservice.org/v2/directions/driving-car?api_key=5b3ce3597851110001cf62481ff839df47c04d04acff2795b77f43b7&start=' + point1 + '&end=' + point2;
      if (mymap.hasLayer(path)){
      mymap.removeLayer(path);
      }
      request.open('GET', url);

      request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');

      request.onreadystatechange = function () {
        if (this.readyState === 4) {
          console.log('Status:', this.status);
          console.log('Headers:', this.getAllResponseHeaders());
          console.log(JSON.parse(this.responseText));

          path = L.geoJSON(JSON.parse(this.responseText), {
            style: function (feature) {
              return { color: "#000" };
            }
          });
          path.addTo(mymap);

          point1="";
          point2="";
        }
      };

      request.send();
      mymap.removeLayer(pt1);
          mymap.removeLayer(pt2);

    }
  </script>



</body>

</html>